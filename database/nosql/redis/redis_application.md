# Redis与应用场景的结合

## 客户联系方式

### 简介

需要对一个保存了6万个客户联系方式的关系数据库进行搜索，搜索可根据名字、邮件地址、所在地和电话号码来进行，每次搜索需要花费10-15秒的时间。

在使用redis重新构建该搜索引擎后，不仅可以以各种信息来过滤和排序客户联系方式，并且每次操作都可以在50毫秒内完成。

## 文章投票网站

### 简介

如果一篇文章获得了至少200张支持票，那么网站就认为这篇文章是一篇有趣的文章；加入网站每天发布1000篇文章，而其中50篇符合网站对有趣文章的要求，那么网站要做的就是把这50篇文章放到文章列表前100位至少1天；网站暂时不提供反对票功能。

为了产生随时间流逝而不断减少的评分，程序根据文章的发布时间和当前时间计算文章评分。具体计算方法为，将文章得到的支持票数量乘以一个常量，然后加上文章的发布时间，得出的结果就是文章的评分。

为了节约内存，规定当一篇文章发布期满一周之后，用户将不能再对其投票，其评分将会固定，而记录文章投票用户名单的集合也会被删除。

文章可以分组，分组内支持按分值或发布时间查询文章。

### 使用Redis存数据

使用一个HASH存储文章信息，名为article:[article_number]，如article:92617。

使用两个ZSET来有序存储文章，一个成员为文章ID，分值为文章发布时间，有序集合名为time:。另一个成员为文章ID，分值为文章评分，有序集合为score:。

每篇文章有一个投票用户名单SET，名为voted:[article_number]，如user:100408。

每个分组用一个SET存储，名为group:[group_name]，如group:programming。

当需要对组内的文章排序时，用ZINTERSTORE命令让redis计算一个中间排序结果，并返回结果。中间排序结果是一个ZSET，名为[order]:[group_name]，如score:programming。为了不过多占用内存，该ZSET设置了60s的缓存时间。

### 代码

https://github.com/josiahcarlson/redis-in-action/blob/master/python/ch01_listing_source.py

### 经验总结

- 业务中需要对数据进行排序、按顺序检索、按范围检索等操作，则可以使用ZSET存储数据。在本例中，希望按发布时间、评分检索文章。

- 可以用SET而没必要用ZSET存储的尽量用SET存储。在本例中，如每篇文章投票用户名单用一个SET存储，是因为没有对这些用户进行排序等等的业务需求，倘若有，也需要考虑用ZSET。

- 有些中间结果只是一时的业务需要，则可以临时计算并存储，为其设置过期时间即可。在本例中，对programming分组按评分排序，使用了一个ZSET，如果每出现类似业务需求都要存储一个ZSET，redis的存储压力会变大，而且当ZSET内数据量大时，redis会比较花时间。在本例中，如果对programming分组按评分排序这个业务需求变得频繁起来了，也要考虑让该ZSET在redis存储中更持久一些。

### 思考

本例中对programming分组按评分排序，生成了一个中间结果ZSET使用，最后需要删除。既然最后都要删除，那将数据读取到程序内存中使用代码排序也行、使用磁盘数据库排序也行、使用磁盘数据库建立索引直接查询也行，使用redis一定比其他方法优越吗？

设计实验对比几种方法，主要对比指标为：生成中间结果并返回查询结果的时间，存储中间结果（额外存储）所需空间。

Java
Python
Nodejs
MySQL



